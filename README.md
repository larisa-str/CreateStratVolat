# CreateStratVolat
### Создание файла опционной стратегии 'Моя_стратегия.str' по заданному Pfttern/Шаблону.
- Шаблоны хранятся в файле "patterns.yaml". 
- Файл стратегии *.str будет загружаться в Quik, в модуль опционный аналитики: Главное меню -> Расширения -> Стратегии. 
- За работу модуля опционной аналитики отвечает StratVolat.dll).

#### Запуск в работу [createstrat.py]:
```php
$ python3 createstrat.py --strat LongCall ShortCall LongStraddle --expiration 20200922 --baseprice 122500
```
#### Workflows: 
**A.**  Подготавливаются PATTERNS/ШАБЛОНЫ стратегий (patterns.yaml).
```php
Пр.: 
Шаблон =  ДвеВерш_up_fut:       ["Две-Вершины (движение вверх)", "-6*put(2), -3*put(-4), put(3), call(1), 3*call(-3), 8*call(1), fut(1)"]
Шаблон =  ShortCall:            ["Короткий CALL", "call(-1x)"]
Шаблон =  ShortCall_синтетика:  ["Синтетический короткий CALL (PUT + фьючерс)", "put(-1), fut(-1)"]

Описание Шаблонов стратегий / Patterns:
# "1*" - шаги - кол-во страйков начиная от текущего
# (10), (-10) - кол-во позиций по инструменту
# "c" или "0*с": покупка CALL 1 шт. (текущего) страйка-точки отсчёта
# "1*c":         покупка CALL 1 шт. через 1 страйк относительно страйка-точки отсчёта
# "2*c(10)":     покупка 10 шт. CALL через 2 страйка вперёд относительно страйка-точки отсчёта
# "-2*c(10)":    покупка 10 шт. CALL через 2 страйка назад относительно страйка-точки отсчёта
# "2*c(-10)":    продажа 10 шт. CALL через 2 страйка относительно страйка-точки отсчёта
# "fut":         покупка 1 фьючерса на базовый актив
``` 
 
**B.** Главный модуль createstrat.py строит Quik-стратегию, т.е. собирает файл в формате Quik (*.str) по шаблону pattern:
 - класс МОДЕЛЬ/MODEL (model.py) - сначала строит модель стратегии по шаблону,
 ```php
 Пр. Шаблон pattern = "-2*put(x), call(y)"   => Модель = "-2*RI125000BS0A(x), RI125000BG0A(y)",
```
- далее, используя модель, собирает параметры стратегии,
```php
Пр. Модель => Параметры стратегии:  {"RI125000BS0A":["3", "22", "0"], "RI125000BG0A":["2", "33", "0"]..}
```
- далее, класс "QuikStr" (quikstr.py) - используя параметры стратегии, собирает файл в QUIK-формате (*.str),
```php
Пр. Содержимое файла "Моя_стратегия_0522.str":
['INFOSTR\x04\x00\x00\x00\n', 'ВрезанВершины_145000_0317.str&nopattern&RTS&1&SPBFUT&RIH2&0 0 0 145000 0 20200630 0 0 145000 0 20220317 33023 16744448 255 1 1 1 0 12 3 20220317 125000 1 1 0 2 RI125000BO2 SPBOPT 1 3 20220317 130000 2 2 0 2 RI130000BO2 SPBOPT 1 3 20220317 137500 1 1 0 2 RI137500BO2 SPBOPT 1 3 20220317 135000 1 2 0 2 RI135000BO2 SPBOPT 1 3 20220317 140000 2 4 0 2 RI140000BO2 SPBOPT 1 3 20220317 145000 1 2 0 2 RI145000BO2 SPBOPT 1 2 20220317 145000 1 2 0 2 RI145000BC2 SPBOPT 1 2 20220317 150000 2 4 0 2 RI150000BC2 SPBOPT 1 2 20220317 155000 1 2 0 2 RI155000BC2 SPBOPT 1 2 20220317 152500 1 1 0 2 RI152500BC2 SPBOPT 1 2 20220317 160000 2 2 0 2 RI160000BC2 SPBOPT 1 2 20220317 165000 1 1 0 2 RI165000BC2 SPBOPT 1 1 20000\n']

Пр.
[INFOSTR
 LongCall_18июня-5.str&Лонг колл&RTS&1&SPBFUT&RIM0&3 12 4 121120 0 20200614 23 5 121120 0 20200618 33023 16744448 255 1 1 1 0 1 2 20200618 120000 1 1 2900 6   RI120000BF0 SPBOPT 1 1 111000]

Пр. 
[INFOSTR
LongCall_18июня.str&nopattern&RTS&1&SPBFUT&RIM0&      [Имя файла=LongCall_18июня.str, ШаблонQuik=nopattern, --??Инструмент--=1, SPBFUT, RIM0]
0                                   [Фактич: ставка=0]
10 0 121120 0 20200614              [Сценарий 1:  волат=+10, ставка=0, цена б/а=121120, --??xxx--=0, дата расчёта=14.06.2020]
20 0 121120 0 20200618              [Сценарий 2:  волат=+20, ставка=0, цена б/а=121120, --??xxx--=0, дата расчёта=18.06.2020]
33023 16744448 255                  [цвета графика= ---(фактич), ---(сценарий1), 255(сценарий2)]
1 0 1                               [График(CheckBox, вкл./выкл. сценарий): 1-(фактич), 0-(сценарий1), 1-(сценарий2)]
0 1                                 [Отображать прибыль в валюте=0, кол-во компонентов в таблице Позиций=1]
2 20200618 120000 1 1 2900          [Тип иснтрумента(1=Call, 2=Put), Дата.исп.=18.06.2020, Страйк=120000, Тип сделки(long=1, Short=2), Кол-во=1, Цена=2900]
6 RI120000BF0 SPBOPT 1              [Источник=6(Предложение), Код инструмента=RI120000BF0, Площадка=SPBOPT, Вкл./выкл.инструмент=1]
1 20000                             [Обновлять рын.информацию=1, Время обновл.=20 сек.(+,000???)]
]
```
